<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinVision Pro - Advanced Finance Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #6c63ff;
            --success: #06d6a0;
            --danger: #ef476f;
            --warning: #ffd166;
            --info: #118ab2;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --body-bg: #f8faff;
            --card-bg: #ffffff;
            --text-color: #2d3748;
            --border-radius: 16px;
            --box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s ease;
            --card-padding: 1.5rem;
        }

        .dark-mode {
            --body-bg: #121826;
            --card-bg: #1a2236;
            --text-color: #e2e8f0;
            --light-gray: #2d3748;
            --box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--body-bg);
            color: var(--text-color);
            transition: var(--transition);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            width: 100%;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo span {
            background: linear-gradient(45deg, #fff, #e0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.3);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid white;
            color: white;
        }

        .btn-outline:hover {
            background-color: white;
            color: var(--primary);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .dashboard {
            padding: 2rem 0;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: var(--card-padding);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
        }

        .card-income::before {
            background-color: var(--success);
        }

        .card-expense::before {
            background-color: var(--danger);
        }

        .card-balance::before {
            background-color: var(--primary);
        }

        .card-budget::before {
            background-color: var(--warning);
        }

        .card-title {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
            font-family: 'Roboto Mono', monospace;
        }

        .card-change {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .positive {
            color: var(--success);
        }

        .negative {
            color: var(--danger);
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 1024px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        .chart-card {
            min-height: 380px;
            padding: var(--card-padding);
            display: flex;
            flex-direction: column;
        }

        .chart-container {
            flex: 1;
            min-height: 300px;
            position: relative;
        }

        .transactions {
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .filters {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .filter-item {
            background-color: var(--body-bg);
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            padding: 0.75rem 1rem;
            font-size: 0.9rem;
            color: var(--text-color);
            min-width: 150px;
        }

        .transaction-table-container {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }

        .transaction-table {
            width: 100%;
            border-collapse: collapse;
        }

        .transaction-table th,
        .transaction-table td {
            padding: 1rem 1.25rem;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }

        .transaction-table th {
            background-color: var(--light-gray);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .transaction-table th:hover {
            background-color: var(--primary);
            color: white;
        }

        .transaction-table tr:last-child td {
            border-bottom: none;
        }

        .transaction-table tr {
            transition: var(--transition);
        }

        .transaction-table tr:hover {
            background-color: rgba(67, 97, 238, 0.05);
        }

        .category-badge {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            color: white;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: var(--gray);
            transition: var(--transition);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn:hover {
            color: var(--primary);
            background-color: rgba(67, 97, 238, 0.1);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 600px;
            padding: 2rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal.show {
            display: flex;
        }

        .modal.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--light-gray);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--danger);
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            background-color: var(--card-bg);
            color: var(--text-color);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .form-select {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            background-color: var(--card-bg);
            color: var(--text-color);
            font-size: 1rem;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 16px;
        }

        .form-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        footer {
            background-color: var(--card-bg);
            padding: 2rem 0;
            text-align: center;
            margin-top: auto;
            border-top: 1px solid var(--light-gray);
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
        }

        .footer-link {
            color: var(--gray);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-link:hover {
            color: var(--primary);
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-buttons {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }

            .transaction-table {
                display: block;
                overflow-x: auto;
            }

            .filters {
                flex-direction: column;
            }

            .filter-item {
                min-width: unset;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 0.6rem 1rem;
            }
        }

        /* Animation for new transactions */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        /* Confirmation modal */
        .confirmation-modal .modal-content {
            max-width: 450px;
        }

        .confirmation-text {
            margin-bottom: 1.25rem;
            font-size: 1.1rem;
            line-height: 1.5;
        }

        .confirmation-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            background-color: var(--success);
            color: white;
            box-shadow: var(--box-shadow);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1100;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background-color: var(--danger);
        }

        .notification.warning {
            background-color: var(--warning);
            color: var(--dark);
        }

        .budget-warning {
            color: var(--warning);
            font-size: 0.9rem;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .budget-danger {
            color: var(--danger);
            font-size: 0.9rem;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tab-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--light-gray);
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            transition: var(--transition);
            font-weight: 500;
            white-space: nowrap;
        }

        .tab.active {
            background-color: var(--primary);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .goal-progress {
            height: 8px;
            background-color: var(--light-gray);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .insight-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--box-shadow);
            margin-bottom: 1.5rem;
        }

        .insight-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 1rem;
        }

        .insight-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(67, 97, 238, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }

        .savings-rate {
            font-size: 1.8rem;
            font-weight: 700;
            text-align: center;
            margin: 1rem 0;
        }

        .trend-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .search-container {
            position: relative;
            width: 100%;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 3rem 0.75rem 1rem;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            background-color: var(--card-bg);
            color: var(--text-color);
            font-size: 1rem;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .search-icon {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .empty-state {
            text-align: center;
            padding: 2.5rem 1.5rem;
        }

        .empty-state-icon {
            font-size: 3rem;
            color: var(--light-gray);
            margin-bottom: 1rem;
        }

        .category-management {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .category-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 1rem;
            background-color: var(--body-bg);
            border-radius: var(--border-radius);
        }

        .category-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .recurring-badge {
            background-color: var(--info);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            margin-left: 5px;
        }

        .chart-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--gray);
            flex-direction: column;
            gap: 1rem;
        }
        
        /* Settings styles */
        .settings-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .setting-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--box-shadow);
        }
        
        .setting-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 1rem;
        }
        
        .setting-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(67, 97, 238, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }
        
        .setting-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 1rem 0;
            font-family: 'Roboto Mono', monospace;
        }
        
        .setting-form {
            margin-top: 1rem;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .quick-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .card-actions {
            display: flex;
            gap: 0.5rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-chart-line"></i>
                    <span>FinVision Pro</span>
                </div>
                <div class="nav-buttons">
                    <div class="search-container">
                        <input type="text" class="search-input" id="searchInput" placeholder="Search transactions...">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                    <button class="btn btn-outline" id="exportBtn">
                        <i class="fas fa-download"></i> Export
                    </button>
                    <button class="btn btn-primary" id="addTransactionBtn">
                        <i class="fas fa-plus"></i> New Transaction
                    </button>
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <section class="dashboard">
            <div class="summary-cards">
                <div class="card card-income">
                    <div class="card-header">
                        <p class="card-title"><i class="fas fa-arrow-down"></i> Total Income</p>
                        <div class="card-actions">
                            <button class="action-btn" title="View income report">
                                <i class="fas fa-chart-bar"></i>
                            </button>
                        </div>
                    </div>
                    <p class="card-value income" id="totalIncome">$0.00</p>
                    <p class="card-change positive" id="incomeChange"><i class="fas fa-arrow-up"></i> 0% from last month</p>
                </div>
                <div class="card card-expense">
                    <div class="card-header">
                        <p class="card-title"><i class="fas fa-arrow-up"></i> Total Expenses</p>
                        <div class="card-actions">
                            <button class="action-btn" title="View expenses report">
                                <i class="fas fa-chart-bar"></i>
                            </button>
                        </div>
                    </div>
                    <p class="card-value expense" id="totalExpenses">$0.00</p>
                    <p class="card-change negative" id="expenseChange"><i class="fas fa-arrow-up"></i> 0% from last month</p>
                </div>
                <div class="card card-balance">
                    <div class="card-header">
                        <p class="card-title"><i class="fas fa-wallet"></i> Balance</p>
                        <div class="card-actions">
                            <button class="action-btn" title="View balance history">
                                <i class="fas fa-history"></i>
                            </button>
                        </div>
                    </div>
                    <p class="card-value balance" id="balance">$0.00</p>
                    <p class="card-change positive" id="balanceChange"><i class="fas fa-arrow-up"></i> 0% from last month</p>
                </div>
                <div class="card card-budget">
                    <div class="card-header">
                        <p class="card-title"><i class="fas fa-chart-pie"></i> Monthly Budget</p>
                        <div class="card-actions">
                            <button class="action-btn edit-budget-btn" title="Edit budget">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </div>
                    <p class="card-value" id="monthlyBudget">$2,000.00</p>
                    <p class="budget-warning" id="budgetWarning"><i class="fas fa-exclamation-circle"></i> <span id="budgetText">0% of budget used</span></p>
                    <div class="quick-actions">
                        <button class="btn btn-sm btn-outline">Increase 10%</button>
                        <button class="btn btn-sm btn-outline">Set Custom</button>
                    </div>
                </div>
            </div>

            <div class="charts-grid">
                <div class="card chart-card">
                    <div class="card-header">
                        <p class="card-title"><i class="fas fa-chart-doughnut"></i> Expenses by Category</p>
                        <div class="card-actions">
                            <button class="action-btn" title="Customize chart">
                                <i class="fas fa-cog"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
                <div class="card chart-card">
                    <div class="card-header">
                        <p class="card-title"><i class="fas fa-chart-line"></i> Income vs Expenses</p>
                        <div class="card-actions">
                            <button class="action-btn" title="Customize chart">
                                <i class="fas fa-cog"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="tab-container">
                <div class="tab active" data-tab="transactions">Transactions</div>
                <div class="tab" data-tab="insights">Financial Insights</div>
                <div class="tab" data-tab="goals">Savings Goals</div>
                <div class="tab" data-tab="settings">Settings</div>
            </div>

            <div class="tab-content active" id="transactions-tab">
                <section class="transactions">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-history"></i> Recent Transactions</h2>
                        <div>
                            <button class="btn btn-outline" id="filterBtn">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                        </div>
                    </div>

                    <div class="filters" id="filtersContainer" style="display: none;">
                        <select class="filter-item" id="typeFilter">
                            <option value="">All Types</option>
                            <option value="income">Income</option>
                            <option value="expense">Expense</option>
                        </select>
                        <select class="filter-item" id="categoryFilter">
                            <option value="">All Categories</option>
                            <!-- Categories will be populated dynamically -->
                        </select>
                        <input type="date" class="filter-item" id="startDate">
                        <input type="date" class="filter-item" id="endDate">
                        <select class="filter-item" id="amountFilter">
                            <option value="">Any Amount</option>
                            <option value="0-50">$0 - $50</option>
                            <option value="50-100">$50 - $100</option>
                            <option value="100-500">$100 - $500</option>
                            <option value="500+">$500+</option>
                        </select>
                        <button class="btn btn-primary" id="applyFilters">
                            <i class="fas fa-check"></i> Apply
                        </button>
                        <button class="btn btn-outline" id="clearFilters">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>

                    <div class="transaction-table-container">
                        <table class="transaction-table">
                            <thead>
                                <tr>
                                    <th data-sort="date">Date <i class="fas fa-sort"></i></th>
                                    <th data-sort="description">Description <i class="fas fa-sort"></i></th>
                                    <th data-sort="category">Category <i class="fas fa-sort"></i></th>
                                    <th data-sort="amount">Amount <i class="fas fa-sort"></i></th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="transactionsBody">
                                <!-- Transactions will be populated dynamically -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>

            <div class="tab-content" id="insights-tab">
                <div class="insights-container">
                    <div class="insight-card">
                        <div class="insight-header">
                            <div class="insight-icon">
                                <i class="fas fa-piggy-bank"></i>
                            </div>
                            <h3>Savings Rate</h3>
                        </div>
                        <div class="savings-rate" id="savingsRate">0%</div>
                        <p>Your savings rate is the percentage of your income that you're saving each month.</p>
                    </div>

                    <div class="insight-card">
                        <div class="insight-header">
                            <div class="insight-icon">
                                <i class="fas fa-tags"></i>
                            </div>
                            <h3>Top Spending Category</h3>
                        </div>
                        <p id="topCategory">You haven't spent anything yet</p>
                        <div class="trend-indicator" id="categoryTrend"></div>
                    </div>

                    <div class="insight-card">
                        <div class="insight-header">
                            <div class="insight-icon">
                                <i class="fas fa-bullseye"></i>
                            </div>
                            <h3>Spending Forecast</h3>
                        </div>
                        <p id="spendingForecast">Based on your current spending, you're on track to spend $0 this month.</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="goals-tab">
                <div class="card">
                    <div class="card-header">
                        <p class="card-title"><i class="fas fa-bullseye"></i> Savings Goals</p>
                        <div class="card-actions">
                            <button class="action-btn" title="Add new goal">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    <p>Set financial goals and track your progress</p>
                    
                    <div class="form-group">
                        <label class="form-label" for="goalName">Goal Name</label>
                        <input type="text" class="form-input" id="goalName" placeholder="e.g., New Laptop">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="goalAmount">Target Amount</label>
                        <input type="number" class="form-input" id="goalAmount" placeholder="0.00" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="goalDeadline">Target Date</label>
                        <input type="date" class="form-input" id="goalDeadline">
                    </div>
                    
                    <button class="btn btn-primary" id="addGoalBtn">
                        <i class="fas fa-plus"></i> Add Goal
                    </button>
                    
                    <div id="goalsList">
                        <!-- Goals will be populated here -->
                    </div>
                </div>
            </div>

            <div class="tab-content" id="settings-tab">
                <div class="settings-container">
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <h3>Monthly Budget</h3>
                        </div>
                        <div class="setting-value" id="currentBudget">$2,000.00</div>
                        <p>Your monthly spending limit. You'll get alerts when approaching this limit.</p>
                        
                        <div class="setting-form">
                            <div class="form-group">
                                <label class="form-label" for="newBudget">New Budget Amount</label>
                                <input type="number" class="form-input" id="newBudget" placeholder="Enter amount" step="0.01" min="0">
                            </div>
                            <button class="btn btn-primary" id="updateBudgetBtn">
                                <i class="fas fa-save"></i> Update Budget
                            </button>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h4>Budget History</h4>
                            <div id="budgetHistory">
                                <!-- Budget history will be populated here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-icon">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <h3>Starting Balance</h3>
                        </div>
                        <div class="setting-value" id="currentBalance">$0.00</div>
                        <p>Your initial account balance. This will be added to your calculated balance.</p>
                        
                        <div class="setting-form">
                            <div class="form-group">
                                <label class="form-label" for="newBalance">New Starting Balance</label>
                                <input type="number" class="form-input" id="newBalance" placeholder="Enter amount" step="0.01">
                            </div>
                            <button class="btn btn-primary" id="updateBalanceBtn">
                                <i class="fas fa-save"></i> Update Balance
                            </button>
                        </div>
                    </div>
                    
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-icon">
                                <i class="fas fa-cogs"></i>
                            </div>
                            <h3>Other Settings</h3>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="currencySelect">Currency</label>
                            <select class="form-select" id="currencySelect">
                                <option value="$">USD ($)</option>
                                <option value="€">EUR (€)</option>
                                <option value="£">GBP (£)</option>
                                <option value="¥">JPY (¥)</option>
                                <option value="₹">INR (₹)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="notificationsEnabled" checked>
                                Enable Notifications
                            </label>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="budgetAlertsEnabled" checked>
                                Enable Budget Alerts
                            </label>
                        </div>
                        
                        <button class="btn btn-primary" id="saveSettingsBtn">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Add/Edit Transaction Modal -->
    <div class="modal" id="transactionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Add Transaction</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="transactionForm">
                <input type="hidden" id="transactionId">
                <div class="form-group">
                    <label class="form-label" for="type"><i class="fas fa-exchange-alt"></i> Type</label>
                    <select class="form-select" id="type" required>
                        <option value="income">Income</option>
                        <option value="expense">Expense</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="amount"><i class="fas fa-dollar-sign"></i> Amount</label>
                    <input type="number" class="form-input" id="amount" placeholder="0.00" step="0.01" min="0.01" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="category"><i class="fas fa-tag"></i> Category</label>
                    <select class="form-select" id="category" required>
                        <!-- Categories will be populated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="date"><i class="fas fa-calendar"></i> Date</label>
                    <input type="date" class="form-input" id="date" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="description"><i class="fas fa-align-left"></i> Description</label>
                    <input type="text" class="form-input" id="description" placeholder="Enter description">
                </div>
                <div class="form-buttons">
                    <button type="button" class="btn btn-outline" id="cancelBtn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Transaction</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal confirmation-modal" id="confirmationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Confirm Deletion</h2>
                <button class="close-modal">&times;</button>
            </div>
            <p class="confirmation-text">Are you sure you want to delete this transaction? This action cannot be undone.</p>
            <div class="confirmation-buttons">
                <button class="btn btn-outline" id="cancelDeleteBtn">Cancel</button>
                <button class="btn btn-primary" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText"></span>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <p>© 2023 FinVision Pro - Advanced Personal Finance Tracker</p>
                <div class="footer-links">
                    <a href="#" class="footer-link">Privacy Policy</a>
                    <a href="#" class="footer-link">Terms of Service</a>
                    <a href="#" class="footer-link">Contact Us</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Data and State Management
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let categories = JSON.parse(localStorage.getItem('categories')) || [
            { id: 1, name: 'Food', type: 'expense', color: '#f72585' },
            { id: 2, name: 'Transport', type: 'expense', color: '#7209b7' },
            { id: 3, name: 'Entertainment', type: 'expense', color: '#3a0ca3' },
            { id: 4, name: 'Bills', type: 'expense', color: '#4361ee' },
            { id: 5, name: 'Shopping', type: 'expense', color: '#4cc9f0' },
            { id: 6, name: 'Healthcare', type: 'expense', color: '#fca311' },
            { id: 7, name: 'Salary', type: 'income', color: '#06d6a0' },
            { id: 8, name: 'Freelance', type: 'income', color: '#27ae60' },
            { id: 9, name: 'Investment', type: 'income', color: '#118ab2' },
            { id: 10, name: 'Gifts', type: 'income', color: '#9b59b6' }
        ];
        
        let goals = JSON.parse(localStorage.getItem('goals')) || [];
        
        // Load settings from localStorage or set defaults
        let settings = JSON.parse(localStorage.getItem('settings')) || {
            monthlyBudget: 2000,
            startingBalance: 0,
            currency: '$',
            notifications: true,
            budgetAlerts: true,
            budgetHistory: []
        };
        
        let currentSort = { field: 'date', direction: 'desc' };
        let currentFilters = {
            type: '',
            category: '',
            startDate: '',
            endDate: '',
            amount: ''
        };

        // DOM Elements
        const transactionsBody = document.getElementById('transactionsBody');
        const totalIncomeEl = document.getElementById('totalIncome');
        const totalExpensesEl = document.getElementById('totalExpenses');
        const balanceEl = document.getElementById('balance');
        const monthlyBudgetEl = document.getElementById('monthlyBudget');
        const budgetWarningEl = document.getElementById('budgetWarning');
        const budgetTextEl = document.getElementById('budgetText');
        const categoryFilter = document.getElementById('categoryFilter');
        const categorySelect = document.getElementById('category');
        const transactionForm = document.getElementById('transactionForm');
        const transactionModal = document.getElementById('transactionModal');
        const confirmationModal = document.getElementById('confirmationModal');
        const modalTitle = document.getElementById('modalTitle');
        const themeToggle = document.getElementById('themeToggle');
        const notificationEl = document.getElementById('notification');
        const notificationTextEl = document.getElementById('notificationText');
        const incomeChangeEl = document.getElementById('incomeChange');
        const expenseChangeEl = document.getElementById('expenseChange');
        const balanceChangeEl = document.getElementById('balanceChange');
        const savingsRateEl = document.getElementById('savingsRate');
        const topCategoryEl = document.getElementById('topCategory');
        const categoryTrendEl = document.getElementById('categoryTrend');
        const spendingForecastEl = document.getElementById('spendingForecast');
        const searchInput = document.getElementById('searchInput');
        
        // Settings elements
        const currentBudgetEl = document.getElementById('currentBudget');
        const newBudgetInput = document.getElementById('newBudget');
        const updateBudgetBtn = document.getElementById('updateBudgetBtn');
        const budgetHistoryEl = document.getElementById('budgetHistory');
        const currentBalanceEl = document.getElementById('currentBalance');
        const newBalanceInput = document.getElementById('newBalance');
        const updateBalanceBtn = document.getElementById('updateBalanceBtn');
        const currencySelect = document.getElementById('currencySelect');
        const notificationsEnabled = document.getElementById('notificationsEnabled');
        const budgetAlertsEnabled = document.getElementById('budgetAlertsEnabled');
        const saveSettingsBtn = document.getElementById('saveSettingsBtn');
        const editBudgetBtn = document.querySelector('.edit-budget-btn');

        // Chart instances
        let categoryChart, trendChart;

        // Initialize the application
        function init() {
            renderTransactions();
            updateSummary();
            initCharts();
            populateCategoryFilters();
            setMinMaxDates();
            attachEventListeners();
            updateInsights();
            renderGoals();
            loadSettings();
            renderBudgetHistory();
            
            // Add some sample data if no transactions exist
            if (transactions.length === 0) {
                addSampleData();
            }
        }

        // Add sample data for demonstration
        function addSampleData() {
            const sampleTransactions = [
                { id: 1, type: 'income', amount: 3500, category: 'Salary', date: '2023-06-15', description: 'Monthly salary' },
                { id: 2, type: 'expense', amount: 120, category: 'Food', date: '2023-06-16', description: 'Grocery shopping' },
                { id: 3, type: 'expense', amount: 45, category: 'Transport', date: '2023-06-17', description: 'Gas refill' },
                { id: 4, type: 'expense', amount: 85, category: 'Entertainment', date: '2023-06-18', description: 'Movie tickets' },
                { id: 5, type: 'expense', amount: 220, category: 'Bills', date: '2023-06-19', description: 'Electricity bill' },
                { id: 6, type: 'income', amount: 500, category: 'Freelance', date: '2023-06-20', description: 'Website project' },
                { id: 7, type: 'expense', amount: 65, category: 'Food', date: '2023-06-21', description: 'Restaurant' },
                { id: 8, type: 'expense', amount: 150, category: 'Shopping', date: '2023-06-22', description: 'Clothes' },
                { id: 9, type: 'expense', amount: 90, category: 'Healthcare', date: '2023-06-23', description: 'Pharmacy' },
                { id: 10, type: 'income', amount: 250, category: 'Gifts', date: '2023-06-24', description: 'Birthday gift' }
            ];
            
            transactions = sampleTransactions;
            saveData();
            renderTransactions();
            updateSummary();
            updateCharts();
            updateInsights();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('transactions', JSON.stringify(transactions));
            localStorage.setItem('categories', JSON.stringify(categories));
            localStorage.setItem('goals', JSON.stringify(goals));
            localStorage.setItem('settings', JSON.stringify(settings));
        }

        // Load settings
        function loadSettings() {
            currentBudgetEl.textContent = `${settings.currency}${settings.monthlyBudget.toFixed(2)}`;
            monthlyBudgetEl.textContent = `${settings.currency}${settings.monthlyBudget.toFixed(2)}`;
            currentBalanceEl.textContent = `${settings.currency}${settings.startingBalance.toFixed(2)}`;
            
            currencySelect.value = settings.currency;
            notificationsEnabled.checked = settings.notifications;
            budgetAlertsEnabled.checked = settings.budgetAlerts;
        }

        // Update budget
        function updateBudget() {
            const newBudget = parseFloat(newBudgetInput.value);
            
            if (isNaN(newBudget) || newBudget < 0) {
                showNotification('Please enter a valid budget amount', true);
                return;
            }
            
            // Add to budget history
            settings.budgetHistory.unshift({
                date: new Date().toISOString(),
                oldValue: settings.monthlyBudget,
                newValue: newBudget
            });
            
            // Keep only last 10 changes
            if (settings.budgetHistory.length > 10) {
                settings.budgetHistory.pop();
            }
            
            settings.monthlyBudget = newBudget;
            saveData();
            
            // Update display
            currentBudgetEl.textContent = `${settings.currency}${settings.monthlyBudget.toFixed(2)}`;
            monthlyBudgetEl.textContent = `${settings.currency}${settings.monthlyBudget.toFixed(2)}`;
            
            // Update budget warning
            updateSummary();
            
            // Clear input
            newBudgetInput.value = '';
            
            // Re-render history
            renderBudgetHistory();
            
            showNotification('Budget updated successfully');
        }

        // Update starting balance
        function updateStartingBalance() {
            const newBalance = parseFloat(newBalanceInput.value);
            
            if (isNaN(newBalance)) {
                showNotification('Please enter a valid balance amount', true);
                return;
            }
            
            settings.startingBalance = newBalance;
            saveData();
            
            // Update display
            currentBalanceEl.textContent = `${settings.currency}${settings.startingBalance.toFixed(2)}`;
            
            // Update overall balance
            updateSummary();
            
            // Clear input
            newBalanceInput.value = '';
            
            showNotification('Starting balance updated successfully');
        }

        // Save settings
        function saveSettings() {
            settings.currency = currencySelect.value;
            settings.notifications = notificationsEnabled.checked;
            settings.budgetAlerts = budgetAlertsEnabled.checked;
            
            saveData();
            updateSummary();
            renderTransactions();
            showNotification('Settings saved successfully');
        }

        // Render budget history
        function renderBudgetHistory() {
            budgetHistoryEl.innerHTML = '';
            
            if (settings.budgetHistory.length === 0) {
                budgetHistoryEl.innerHTML = '<p>No budget history available.</p>';
                return;
            }
            
            settings.budgetHistory.forEach(change => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                const date = new Date(change.date);
                const formattedDate = date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                historyItem.innerHTML = `
                    <div>${formattedDate}</div>
                    <div>${settings.currency}${change.oldValue.toFixed(2)} → ${settings.currency}${change.newValue.toFixed(2)}</div>
                `;
                
                budgetHistoryEl.appendChild(historyItem);
            });
        }

        // Render transactions table
        function renderTransactions() {
            let filteredTransactions = filterTransactions();
            filteredTransactions = sortTransactions(filteredTransactions);
            
            // Apply search filter
            const searchTerm = searchInput.value.toLowerCase();
            if (searchTerm) {
                filteredTransactions = filteredTransactions.filter(t => 
                    t.description.toLowerCase().includes(searchTerm) || 
                    t.category.toLowerCase().includes(searchTerm) ||
                    t.amount.toString().includes(searchTerm)
                );
            }
            
            transactionsBody.innerHTML = '';
            
            if (filteredTransactions.length === 0) {
                transactionsBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 30px;">
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <i class="fas fa-receipt"></i>
                                </div>
                                <h3>No transactions found</h3>
                                <p>Try adjusting your filters or add a new transaction</p>
                            </div>
                        </td>
                    </tr>
                `;
                
                return;
            }
            
            filteredTransactions.forEach(transaction => {
                const categoryObj = categories.find(c => c.name === transaction.category);
                const row = document.createElement('tr');
                row.classList.add('fade-in');
                
                row.innerHTML = `
                    <td>${formatDate(transaction.date)}</td>
                    <td>${transaction.description || '-'}</td>
                    <td>
                        <span class="category-badge" style="background-color: ${categoryObj?.color || '#6c757d'}">
                            ${transaction.category}
                        </span>
                    </td>
                    <td class="${transaction.type === 'income' ? 'income' : 'expense'}">
                        ${transaction.type === 'income' ? '+' : '-'}${settings.currency}${Math.abs(transaction.amount).toFixed(2)}
                    </td>
                    <td class="action-buttons">
                        <button class="action-btn edit-btn" data-id="${transaction.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" data-id="${transaction.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                transactionsBody.appendChild(row);
            });
            
            // Attach event listeners to action buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = parseInt(btn.getAttribute('data-id'));
                    editTransaction(id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = parseInt(btn.getAttribute('data-id'));
                    showDeleteConfirmation(id);
                });
            });
        }

        // Filter transactions based on current filters
        function filterTransactions() {
            return transactions.filter(transaction => {
                let passType = true;
                let passCategory = true;
                let passStartDate = true;
                let passEndDate = true;
                let passAmount = true;
                
                if (currentFilters.type) {
                    passType = transaction.type === currentFilters.type;
                }
                
                if (currentFilters.category) {
                    passCategory = transaction.category === currentFilters.category;
                }
                
                if (currentFilters.startDate) {
                    passStartDate = new Date(transaction.date) >= new Date(currentFilters.startDate);
                }
                
                if (currentFilters.endDate) {
                    passEndDate = new Date(transaction.date) <= new Date(currentFilters.endDate);
                }
                
                if (currentFilters.amount) {
                    switch (currentFilters.amount) {
                        case '0-50':
                            passAmount = transaction.amount >= 0 && transaction.amount <= 50;
                            break;
                        case '50-100':
                            passAmount = transaction.amount > 50 && transaction.amount <= 100;
                            break;
                        case '100-500':
                            passAmount = transaction.amount > 100 && transaction.amount <= 500;
                            break;
                        case '500+':
                            passAmount = transaction.amount > 500;
                            break;
                    }
                }
                
                return passType && passCategory && passStartDate && passEndDate && passAmount;
            });
        }

        // Sort transactions based on current sort field and direction
        function sortTransactions(transactionsList) {
            return transactionsList.sort((a, b) => {
                let valueA, valueB;
                
                switch (currentSort.field) {
                    case 'date':
                        valueA = new Date(a.date);
                        valueB = new Date(b.date);
                        break;
                    case 'amount':
                        valueA = a.amount;
                        valueB = b.amount;
                        break;
                    case 'category':
                        valueA = a.category;
                        valueB = b.category;
                        break;
                    case 'description':
                        valueA = a.description || '';
                        valueB = b.description || '';
                        break;
                    default:
                        valueA = a[currentSort.field];
                        valueB = b[currentSort.field];
                }
                
                if (typeof valueA === 'string') {
                    valueA = valueA.toLowerCase();
                    valueB = valueB.toLowerCase();
                }
                
                if (valueA < valueB) {
                    return currentSort.direction === 'asc' ? -1 : 1;
                }
                if (valueA > valueB) {
                    return currentSort.direction === 'asc' ? 1 : -1;
                }
                return 0;
            });
        }

        // Update summary cards
        function updateSummary() {
            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, transaction) => sum + transaction.amount, 0);
                
            const totalExpenses = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, transaction) => sum + transaction.amount, 0);
                
            const balance = settings.startingBalance + totalIncome - totalExpenses;
            
            totalIncomeEl.textContent = `${settings.currency}${totalIncome.toFixed(2)}`;
            totalExpensesEl.textContent = `${settings.currency}${totalExpenses.toFixed(2)}`;
            balanceEl.textContent = `${settings.currency}${balance.toFixed(2)}`;
            
            // Calculate month-over-month changes
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            const lastMonthIncome = transactions
                .filter(t => t.type === 'income' && 
                    new Date(t.date).getMonth() === (currentMonth === 0 ? 11 : currentMonth - 1) &&
                    new Date(t.date).getFullYear() === (currentMonth === 0 ? currentYear - 1 : currentYear))
                .reduce((sum, t) => sum + t.amount, 0);
                
            const lastMonthExpenses = transactions
                .filter(t => t.type === 'expense' && 
                    new Date(t.date).getMonth() === (currentMonth === 0 ? 11 : currentMonth - 1) &&
                    new Date(t.date).getFullYear() === (currentMonth === 0 ? currentYear - 1 : currentYear))
                .reduce((sum, t) => sum + t.amount, 0);
                
            const lastMonthBalance = lastMonthIncome - lastMonthExpenses;
            
            // Calculate percentage changes
            const incomeChange = lastMonthIncome > 0 ? ((totalIncome - lastMonthIncome) / lastMonthIncome) * 100 : 0;
            const expenseChange = lastMonthExpenses > 0 ? ((totalExpenses - lastMonthExpenses) / lastMonthExpenses) * 100 : 0;
            const balanceChange = lastMonthBalance !== 0 ? ((balance - lastMonthBalance) / Math.abs(lastMonthBalance)) * 100 : 0;
            
            // Update change indicators
            incomeChangeEl.innerHTML = `<i class="fas fa-arrow-${incomeChange >= 0 ? 'up' : 'down'}"></i> ${Math.abs(incomeChange).toFixed(1)}% from last month`;
            incomeChangeEl.className = `card-change ${incomeChange >= 0 ? 'positive' : 'negative'}`;
            
            expenseChangeEl.innerHTML = `<i class="fas fa-arrow-${expenseChange >= 0 ? 'up' : 'down'}"></i> ${Math.abs(expenseChange).toFixed(1)}% from last month`;
            expenseChangeEl.className = `card-change ${expenseChange <= 0 ? 'positive' : 'negative'}`;
            
            balanceChangeEl.innerHTML = `<i class="fas fa-arrow-${balanceChange >= 0 ? 'up' : 'down'}"></i> ${Math.abs(balanceChange).toFixed(1)}% from last month`;
            balanceChangeEl.className = `card-change ${balanceChange >= 0 ? 'positive' : 'negative'}`;
            
            // Update budget alert
            const budgetUsage = (totalExpenses / settings.monthlyBudget) * 100;
            
            budgetTextEl.textContent = `${budgetUsage.toFixed(0)}% of budget used`;
            
            if (budgetUsage > 100) {
                budgetWarningEl.className = 'budget-danger';
                budgetWarningEl.innerHTML = `<i class="fas fa-exclamation-triangle"></i> <span id="budgetText">You've exceeded your budget by ${settings.currency}${(totalExpenses - settings.monthlyBudget).toFixed(2)}</span>`;
                monthlyBudgetEl.parentElement.style.borderLeft = `5px solid var(--danger)`;
            } else if (budgetUsage > 80) {
                budgetWarningEl.className = 'budget-warning';
                budgetWarningEl.innerHTML = `<i class="fas fa-exclamation-circle"></i> <span id="budgetText">${budgetUsage.toFixed(0)}% of budget used</span>`;
                monthlyBudgetEl.parentElement.style.borderLeft = `5px solid var(--warning)`;
            } else {
                budgetWarningEl.className = 'budget-warning';
                budgetWarningEl.innerHTML = `<i class="fas fa-check-circle"></i> <span id="budgetText">${budgetUsage.toFixed(0)}% of budget used</span>`;
                monthlyBudgetEl.parentElement.style.borderLeft = `5px solid var(--success)`;
            }
        }

        // Update financial insights
        function updateInsights() {
            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, transaction) => sum + transaction.amount, 0);
                
            const totalExpenses = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, transaction) => sum + transaction.amount, 0);
                
            // Calculate savings rate
            const savingsRate = totalIncome > 0 ? ((totalIncome - totalExpenses) / totalIncome) * 100 : 0;
            savingsRateEl.textContent = `${savingsRate.toFixed(1)}%`;
            
            // Find top spending category
            const expenseCategories = {};
            
            transactions
                .filter(t => t.type === 'expense')
                .forEach(transaction => {
                    if (expenseCategories[transaction.category]) {
                        expenseCategories[transaction.category] += transaction.amount;
                    } else {
                        expenseCategories[transaction.category] = transaction.amount;
                    }
                });
            
            let topCategory = '';
            let topAmount = 0;
            
            for (const category in expenseCategories) {
                if (expenseCategories[category] > topAmount) {
                    topAmount = expenseCategories[category];
                    topCategory = category;
                }
            }
            
            if (topCategory) {
                topCategoryEl.textContent = `Your top spending category is ${topCategory} (${settings.currency}${topAmount.toFixed(2)})`;
                
                // Add trend indicator
                const categoryObj = categories.find(c => c.name === topCategory);
                if (categoryObj) {
                    categoryTrendEl.innerHTML = `<span style="color: ${categoryObj.color}"><i class="fas fa-arrow-up"></i> ${(topAmount/totalExpenses*100).toFixed(1)}% of total expenses</span>`;
                }
            } else {
                topCategoryEl.textContent = 'You haven\'t spent anything yet';
                categoryTrendEl.innerHTML = '';
            }
            
            // Spending forecast
            const now = new Date();
            const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            const daysSoFar = now.getDate();
            
            const dailySpending = totalExpenses / daysSoFar;
            const projectedSpending = dailySpending * daysInMonth;
            
            spendingForecastEl.textContent = `Based on your current spending, you're on track to spend ${settings.currency}${projectedSpending.toFixed(2)} this month.`;
        }

        // Initialize charts
        function initCharts() {
            const categoryCtx = document.getElementById('categoryChart');
            const trendCtx = document.getElementById('trendChart');
            
            // Category chart (doughnut)
            categoryChart = new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [],
                        borderWidth: 0,
                        hoverOffset: 12
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: {
                                    family: "'Poppins', sans-serif"
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true
                    },
                    cutout: '65%'
                }
            });
            
            // Trend chart (line)
            trendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Income',
                            data: [],
                            borderColor: '#06d6a0',
                            backgroundColor: 'rgba(6, 214, 160, 0.1)',
                            tension: 0.3,
                            fill: true,
                            borderWidth: 3
                        },
                        {
                            label: 'Expenses',
                            data: [],
                            borderColor: '#ef476f',
                            backgroundColor: 'rgba(239, 71, 111, 0.1)',
                            tension: 0.3,
                            fill: true,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    family: "'Roboto Mono', monospace"
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    family: "'Poppins', sans-serif"
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: {
                                    family: "'Poppins', sans-serif"
                                }
                            }
                        }
                    }
                }
            });
            
            updateCharts();
        }

        // Update charts with current data
        function updateCharts() {
            updateCategoryChart();
            updateTrendChart();
        }

        // Update category chart
        function updateCategoryChart() {
            const expenseCategories = categories.filter(c => c.type === 'expense');
            const categoryTotals = {};
            
            // Initialize totals
            expenseCategories.forEach(category => {
                categoryTotals[category.name] = 0;
            });
            
            // Calculate totals
            transactions
                .filter(t => t.type === 'expense')
                .forEach(transaction => {
                    if (categoryTotals.hasOwnProperty(transaction.category)) {
                        categoryTotals[transaction.category] += transaction.amount;
                    }
                });
            
            // Filter out categories with no data
            const labels = [];
            const data = [];
            const backgroundColors = [];
            
            expenseCategories.forEach(category => {
                if (categoryTotals[category.name] > 0) {
                    labels.push(category.name);
                    data.push(categoryTotals[category.name]);
                    backgroundColors.push(category.color);
                }
            });
            
            // Update chart
            categoryChart.data.labels = labels;
            categoryChart.data.datasets[0].data = data;
            categoryChart.data.datasets[0].backgroundColor = backgroundColors;
            
            categoryChart.update();
        }

        // Update trend chart
        function updateTrendChart() {
            // Group transactions by month
            const monthlyData = {};
            
            transactions.forEach(transaction => {
                const date = new Date(transaction.date);
                const monthYear = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                
                if (!monthlyData[monthYear]) {
                    monthlyData[monthYear] = { income: 0, expense: 0 };
                }
                
                if (transaction.type === 'income') {
                    monthlyData[monthYear].income += transaction.amount;
                } else {
                    monthlyData[monthYear].expense += transaction.amount;
                }
            });
            
            // Sort months chronologically
            const sortedMonths = Object.keys(monthlyData).sort();
            
            // Format month labels (e.g., Jan 2023)
            const monthLabels = sortedMonths.map(month => {
                const [year, monthNum] = month.split('-');
                const date = new Date(year, monthNum - 1);
                return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
            });
            
            // Update chart
            trendChart.data.labels = monthLabels;
            trendChart.data.datasets[0].data = sortedMonths.map(month => monthlyData[month].income);
            trendChart.data.datasets[1].data = sortedMonths.map(month => monthlyData[month].expense);
            
            trendChart.update();
        }

        // Populate category filters and dropdowns
        function populateCategoryFilters() {
            // Clear existing options
            categoryFilter.innerHTML = '<option value="">All Categories</option>';
            categorySelect.innerHTML = '';
            
            // Add categories grouped by type
            const incomeCategories = categories.filter(c => c.type === 'income');
            const expenseCategories = categories.filter(c => c.type === 'expense');
            
            // Add income categories to dropdown
            if (incomeCategories.length > 0) {
                const incomeGroup = document.createElement('optgroup');
                incomeGroup.label = 'Income';
                
                incomeCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.name;
                    option.textContent = category.name;
                    incomeGroup.appendChild(option);
                });
                
                categorySelect.appendChild(incomeGroup);
            }
            
            // Add expense categories to dropdown
            if (expenseCategories.length > 0) {
                const expenseGroup = document.createElement('optgroup');
                expenseGroup.label = 'Expense';
                
                expenseCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.name;
                    option.textContent = category.name;
                    expenseGroup.appendChild(option);
                    
                    // Also add to filter dropdown
                    const filterOption = document.createElement('option');
                    filterOption.value = category.name;
                    filterOption.textContent = category.name;
                    categoryFilter.appendChild(filterOption);
                });
                
                categorySelect.appendChild(expenseGroup);
            }
        }

        // Set min and max dates for date filters
        function setMinMaxDates() {
            if (transactions.length === 0) return;
            
            const dates = transactions.map(t => new Date(t.date));
            const minDate = new Date(Math.min.apply(null, dates));
            const maxDate = new Date(Math.max.apply(null, dates));
            
            document.getElementById('startDate').min = formatDateForInput(minDate);
            document.getElementById('startDate').max = formatDateForInput(maxDate);
            document.getElementById('endDate').min = formatDateForInput(minDate);
            document.getElementById('endDate').max = formatDateForInput(maxDate);
        }

        // Open modal for adding/editing transaction
        function openModal(transaction = null) {
            if (transaction) {
                // Editing existing transaction
                modalTitle.textContent = 'Edit Transaction';
                document.getElementById('transactionId').value = transaction.id;
                document.getElementById('type').value = transaction.type;
                document.getElementById('amount').value = transaction.amount;
                document.getElementById('category').value = transaction.category;
                document.getElementById('date').value = transaction.date;
                document.getElementById('description').value = transaction.description || '';
            } else {
                // Adding new transaction
                modalTitle.textContent = 'Add Transaction';
                document.getElementById('transactionId').value = '';
                document.getElementById('type').value = 'expense';
                document.getElementById('amount').value = '';
                document.getElementById('category').value = '';
                document.getElementById('date').value = new Date().toISOString().split('T')[0];
                document.getElementById('description').value = '';
            }
            
            transactionModal.classList.add('show');
        }

        // Edit transaction
        function editTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            if (transaction) {
                openModal(transaction);
            }
        }

        // Show delete confirmation
        function showDeleteConfirmation(id) {
            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;
            
            confirmationModal.classList.add('show');
            
            document.getElementById('confirmDeleteBtn').onclick = () => {
                deleteTransaction(id);
                confirmationModal.classList.remove('show');
            };
            
            document.getElementById('cancelDeleteBtn').onclick = () => {
                confirmationModal.classList.remove('show');
            };
        }

        // Delete transaction
        function deleteTransaction(id) {
            transactions = transactions.filter(t => t.id !== id);
            saveData();
            renderTransactions();
            updateSummary();
            updateCharts();
            updateInsights();
            showNotification('Transaction deleted successfully');
        }

        // Export data as CSV
        function exportData() {
            if (transactions.length === 0) {
                showNotification('No data to export!', true);
                return;
            }
            
            const headers = ['Date', 'Type', 'Category', 'Amount', 'Description'];
            const csvContent = [
                headers.join(','),
                ...transactions.map(t => [
                    formatDate(t.date),
                    t.type,
                    t.category,
                    t.amount,
                    `"${t.description || ''}"`
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'finvision-export.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showNotification('Data exported successfully');
        }

        // Show notification
        function showNotification(message, isError = false, isWarning = false) {
            notificationTextEl.textContent = message;
            notificationEl.className = 'notification';
            
            if (isError) {
                notificationEl.classList.add('error');
                notificationEl.innerHTML = `<i class="fas fa-exclamation-circle"></i> <span id="notificationText">${message}</span>`;
            } else if (isWarning) {
                notificationEl.classList.add('warning');
                notificationEl.innerHTML = `<i class="fas fa-exclamation-triangle"></i> <span id="notificationText">${message}</span>`;
            } else {
                notificationEl.innerHTML = `<i class="fas fa-check-circle"></i> <span id="notificationText">${message}</span>`;
            }
            
            notificationEl.classList.add('show');
            
            setTimeout(() => {
                notificationEl.classList.remove('show');
            }, 3000);
        }

        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        // Format date for input field
        function formatDateForInput(date) {
            return date.toISOString().split('T')[0];
        }

        // Clear all filters
        function clearFilters() {
            document.getElementById('typeFilter').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            document.getElementById('amountFilter').value = '';
            searchInput.value = '';
            
            currentFilters = {
                type: '',
                category: '',
                startDate: '',
                endDate: '',
                amount: ''
            };
            
            renderTransactions();
        }

        // Render savings goals
        function renderGoals() {
            const goalsList = document.getElementById('goalsList');
            goalsList.innerHTML = '';
            
            if (goals.length === 0) {
                goalsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-bullseye"></i>
                        </div>
                        <h3>No goals yet</h3>
                        <p>Create your first savings goal to get started</p>
                    </div>
                `;
                return;
            }
            
            goals.forEach(goal => {
                const goalEl = document.createElement('div');
                goalEl.className = 'insight-card';
                
                // Calculate progress
                const savedAmount = 1000; // This would come from actual savings data
                const progress = Math.min((savedAmount / goal.amount) * 100, 100);
                
                goalEl.innerHTML = `
                    <div class="insight-header">
                        <h3>${goal.name}</h3>
                        <span>${settings.currency}${savedAmount.toFixed(2)} / ${settings.currency}${goal.amount.toFixed(2)}</span>
                    </div>
                    <div class="goal-progress">
                        <div class="progress-bar" style="width: ${progress}%; background-color: var(--primary);"></div>
                    </div>
                    <p>Target: ${formatDate(goal.deadline)} (${Math.floor(progress)}%)</p>
                `;
                
                goalsList.appendChild(goalEl);
            });
        }

        // Add a new savings goal
        function addGoal() {
            const name = document.getElementById('goalName').value;
            const amount = parseFloat(document.getElementById('goalAmount').value);
            const deadline = document.getElementById('goalDeadline').value;
            
            if (!name || !amount || !deadline) {
                showNotification('Please fill all goal fields', true);
                return;
            }
            
            const newGoal = {
                id: goals.length + 1,
                name,
                amount,
                deadline,
                createdAt: new Date().toISOString()
            };
            
            goals.push(newGoal);
            saveData();
            renderGoals();
            
            document.getElementById('goalName').value = '';
            document.getElementById('goalAmount').value = '';
            document.getElementById('goalDeadline').value = '';
            
            showNotification('Goal added successfully');
        }

        // Attach event listeners
        function attachEventListeners() {
            // Theme toggle
            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                themeToggle.innerHTML = document.body.classList.contains('dark-mode') ? 
                    '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
                saveData();
            });
            
            // Add transaction button
            document.getElementById('addTransactionBtn').addEventListener('click', () => {
                openModal();
            });
            
            // Export button
            document.getElementById('exportBtn').addEventListener('click', exportData);
            
            // Form submission
            transactionForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const id = document.getElementById('transactionId').value;
                const type = document.getElementById('type').value;
                const amount = parseFloat(document.getElementById('amount').value);
                const category = document.getElementById('category').value;
                const date = document.getElementById('date').value;
                const description = document.getElementById('description').value;
                
                if (id) {
                    // Update existing transaction
                    const index = transactions.findIndex(t => t.id === parseInt(id));
                    if (index !== -1) {
                        transactions[index] = { 
                            ...transactions[index], 
                            type, 
                            amount, 
                            category, 
                            date, 
                            description 
                        };
                        showNotification('Transaction updated successfully');
                    }
                } else {
                    // Add new transaction
                    const newId = transactions.length > 0 ? Math.max(...transactions.map(t => t.id)) + 1 : 1;
                    const newTransaction = {
                        id: newId,
                        type,
                        amount,
                        category,
                        date,
                        description
                    };
                    
                    transactions.push(newTransaction);
                    showNotification('Transaction added successfully');
                }
                
                saveData();
                renderTransactions();
                updateSummary();
                updateCharts();
                updateInsights();
                
                transactionModal.classList.remove('show');
            });
            
            // Close modal buttons
            document.querySelectorAll('.close-modal, #cancelBtn').forEach(btn => {
                btn.addEventListener('click', () => {
                    transactionModal.classList.remove('show');
                    confirmationModal.classList.remove('show');
                });
            });
            
            // Table sorting
            document.querySelectorAll('th[data-sort]').forEach(th => {
                th.addEventListener('click', () => {
                    const field = th.getAttribute('data-sort');
                    
                    if (currentSort.field === field) {
                        // Toggle direction if same field
                        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
                    } else {
                        // Set new field and default to ascending
                        currentSort.field = field;
                        currentSort.direction = 'asc';
                    }
                    
                    renderTransactions();
                });
            });
            
            // Filter application
            document.getElementById('applyFilters').addEventListener('click', () => {
                currentFilters.type = document.getElementById('typeFilter').value;
                currentFilters.category = document.getElementById('categoryFilter').value;
                currentFilters.startDate = document.getElementById('startDate').value;
                currentFilters.endDate = document.getElementById('endDate').value;
                currentFilters.amount = document.getElementById('amountFilter').value;
                
                renderTransactions();
            });
            
            // Clear filters
            document.getElementById('clearFilters').addEventListener('click', clearFilters);
            
            // Toggle filters visibility
            document.getElementById('filterBtn').addEventListener('click', () => {
                const filtersContainer = document.getElementById('filtersContainer');
                filtersContainer.style.display = filtersContainer.style.display === 'none' ? 'flex' : 'none';
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === transactionModal) {
                    transactionModal.classList.remove('show');
                }
                if (e.target === confirmationModal) {
                    confirmationModal.classList.remove('show');
                }
            });
            
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
                });
            });
            
            // Search functionality
            searchInput.addEventListener('input', () => {
                renderTransactions();
            });
            
            // Add goal button
            document.getElementById('addGoalBtn').addEventListener('click', addGoal);
            
            // Settings event listeners
            updateBudgetBtn.addEventListener('click', updateBudget);
            updateBalanceBtn.addEventListener('click', updateStartingBalance);
            saveSettingsBtn.addEventListener('click', saveSettings);
            
            // Quick edit budget button
            editBudgetBtn.addEventListener('click', () => {
                // Switch to settings tab
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                document.querySelector('[data-tab="settings"]').classList.add('active');
                document.getElementById('settings-tab').classList.add('active');
                
                // Focus on budget input
                newBudgetInput.focus();
            });
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>